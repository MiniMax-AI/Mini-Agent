# ä¾èµ–ç®¡ç†ç­–ç•¥åˆ†æ

## ğŸ¤” ç”¨æˆ·çš„åé¦ˆï¼š"ä½ ä¸ç”¨éƒ½å¬æˆ‘çš„ï¼Œfastapi è¿˜æœ‰é‚£ä¸ªå…±äº«ç¯å¢ƒå‘¢"

æ‚¨è¯´å¾—å¯¹ï¼è®©æˆ‘é‡æ–°æ€è€ƒä¾èµ–ç®¡ç†ç­–ç•¥ã€‚

---

## ğŸ“Š ä¸¤ç§æ–¹å¼çš„æ·±å…¥å¯¹æ¯”

### æ–¹å¼ 1ï¼šsys.path å¼•ç”¨ï¼ˆå½“å‰æ–¹å¼ï¼‰âœ…

**å½“å‰å®ç°**ï¼š
```python
# backend/app/services/agent_service.py
sys.path.insert(0, str(mini_agent_path.parent))
from mini_agent.agent import Agent
```

**ä¾èµ–åˆ†ç¦»**ï¼š
```
mini_agent/           # æ ¸å¿ƒåº“ï¼ˆçº¯ç²¹çš„ Agentï¼‰
â”œâ”€â”€ pyproject.toml    # åªåŒ…å«æ ¸å¿ƒä¾èµ–
â”‚   â”œâ”€â”€ anthropic     # LLM å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ openai        # LLM å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ tiktoken      # Token è®¡æ•°
â”‚   â”œâ”€â”€ zhipuai       # æœç´¢å·¥å…·
â”‚   â””â”€â”€ ...           # Agent æ ¸å¿ƒä¾èµ–

backend/              # Web æœåŠ¡ï¼ˆç‹¬ç«‹çš„åº”ç”¨ï¼‰
â”œâ”€â”€ requirements.txt  # åªåŒ…å«åç«¯ä¾èµ–
â”‚   â”œâ”€â”€ fastapi       # Web æ¡†æ¶
â”‚   â”œâ”€â”€ uvicorn       # ASGI æœåŠ¡å™¨
â”‚   â”œâ”€â”€ sqlalchemy    # æ•°æ®åº“ ORM
â”‚   â””â”€â”€ ...           # åç«¯ä¸“ç”¨ä¾èµ–
```

**ä¼˜ç‚¹**ï¼š
- âœ… **ä¾èµ–å®Œå…¨åˆ†ç¦»**ï¼šmini_agent ä¸åŒ…å« FastAPI ç­‰åç«¯ä¸“ç”¨ä¾èµ–
- âœ… **å…±äº«ç¯å¢ƒæ›´å¹²å‡€**ï¼šå…±äº«ç¯å¢ƒåªéœ€è¦ mini_agent æ ¸å¿ƒä¾èµ–
- âœ… **èŒè´£æ¸…æ™°**ï¼šmini_agent æ˜¯çº¯ç²¹çš„ Agent åº“ï¼Œbackend æ˜¯ Web æœåŠ¡
- âœ… **çµæ´»æ€§é«˜**ï¼šå¯ä»¥åœ¨ä¸åŒé¡¹ç›®ä¸­ç”¨ä¸åŒæ–¹å¼ä½¿ç”¨ mini_agent
- âœ… **é€‚åˆå¤šç¯å¢ƒéƒ¨ç½²**ï¼šCLIã€åç«¯ã€å…¶ä»–é›†æˆéƒ½å¯ä»¥ç‹¬ç«‹ä½¿ç”¨

**ç¼ºç‚¹**ï¼š
- âŒ IDE æ”¯æŒä¸å¥½ï¼ˆä½†å¯ä»¥é€šè¿‡é…ç½®è§£å†³ï¼‰
- âŒ ä¸æ˜¯ Python "æ ‡å‡†"åšæ³•ï¼ˆä½†æ˜¯åˆç†çš„æ¶æ„é€‰æ‹©ï¼‰
- âŒ éœ€è¦æ‰‹åŠ¨åŒæ­¥ mini_agent çš„æ ¸å¿ƒä¾èµ–ï¼ˆä½†å¯ä»¥è‡ªåŠ¨åŒ–æ£€æŸ¥ï¼‰

---

### æ–¹å¼ 2ï¼špip install -e . âŒ

```bash
pip install -e ".[backend]"
```

**ä¾èµ–åˆå¹¶**ï¼š
```
pyproject.toml
â”œâ”€â”€ [project.dependencies]      # mini_agent æ ¸å¿ƒ
â”‚   â”œâ”€â”€ anthropic
â”‚   â”œâ”€â”€ openai
â”‚   â””â”€â”€ ...
â””â”€â”€ [project.optional-dependencies]
    â””â”€â”€ backend                  # åç«¯é¢å¤–ä¾èµ–
        â”œâ”€â”€ fastapi
        â”œâ”€â”€ uvicorn
        â””â”€â”€ ...
```

**ä¼˜ç‚¹**ï¼š
- âœ… Python æ ‡å‡†åšæ³•
- âœ… IDE å®Œå…¨æ”¯æŒ
- âœ… åªç»´æŠ¤ä¸€ä¸ª pyproject.toml

**ç¼ºç‚¹**ï¼š
- âŒ **æ¦‚å¿µæ··ä¹±**ï¼šmini_agent æ ¸å¿ƒåº“ä¸ºä»€ä¹ˆè¦çŸ¥é“ FastAPIï¼Ÿ
- âŒ **å…±äº«ç¯å¢ƒæ±¡æŸ“**ï¼šCLI å®‰è£…æ—¶ä¹Ÿä¼šçœ‹åˆ° backend ä¾èµ–é€‰é¡¹
- âŒ **èŒè´£ä¸æ¸…**ï¼šmini_agent å˜æˆäº†"å…¨å®¶æ¡¶"
- âŒ **è¿åå•ä¸€èŒè´£åŸåˆ™**ï¼šä¸€ä¸ª Agent åº“ä¸åº”è¯¥å…³å¿ƒ Web æ¡†æ¶

---

## ğŸ¯ å…³é”®é—®é¢˜ï¼šå…±äº«ç¯å¢ƒ

### å…±äº«ç¯å¢ƒçš„ä½œç”¨

```python
# backend/app/utils/init_env.py
def init_shared_env(base_dir: Path):
    """
    åˆå§‹åŒ–å…±äº« Python ç¯å¢ƒ

    ç”¨é€”ï¼š
    1. å¤šä¸ªç”¨æˆ·ä¼šè¯å…±äº«åŒä¸€ä¸ª Python ç¯å¢ƒ
    2. é¿å…é‡å¤å®‰è£…åŒ…ï¼ŒèŠ‚çœç©ºé—´
    3. åŠ å¿«ä¼šè¯åˆ›å»ºé€Ÿåº¦
    """
```

### å…±äº«ç¯å¢ƒåº”è¯¥åŒ…å«ä»€ä¹ˆï¼Ÿ

```
âœ… åº”è¯¥åŒ…å«ï¼ˆAgent æ ¸å¿ƒä¾èµ–ï¼‰ï¼š
â”œâ”€â”€ anthropic       # Agent éœ€è¦
â”œâ”€â”€ openai          # Agent éœ€è¦
â”œâ”€â”€ tiktoken        # Agent éœ€è¦
â”œâ”€â”€ zhipuai         # Agent æœç´¢éœ€è¦
â””â”€â”€ pydantic        # Agent éœ€è¦

âŒ ä¸åº”è¯¥åŒ…å«ï¼ˆåç«¯ä¸“ç”¨ä¾èµ–ï¼‰ï¼š
â”œâ”€â”€ fastapi         # åªæœ‰åç«¯éœ€è¦
â”œâ”€â”€ uvicorn         # åªæœ‰åç«¯éœ€è¦
â”œâ”€â”€ sqlalchemy      # åªæœ‰åç«¯éœ€è¦
â””â”€â”€ python-jose     # åªæœ‰åç«¯éœ€è¦
```

### å¦‚æœç”¨ pip install -e ".[backend]"

**é—®é¢˜ 1**ï¼šCLI ç”¨æˆ·å›°æƒ‘
```bash
# ç”¨æˆ·åªæƒ³è¦ CLI
pip install -e .

# ä½†æ˜¯çœ‹åˆ°äº† backend é€‰é¡¹
pip install -e ".[backend]"  # â† ä¸ºä»€ä¹ˆ CLI å·¥å…·è¦å…³å¿ƒ backendï¼Ÿ
```

**é—®é¢˜ 2**ï¼šå…±äº«ç¯å¢ƒæ˜¯å¦åŒ…å« FastAPIï¼Ÿ
- å¦‚æœåŒ…å«ï¼šæµªè´¹ç©ºé—´ï¼ŒAgent ä¸éœ€è¦
- å¦‚æœä¸åŒ…å«ï¼šé‚£ä¸ºä»€ä¹ˆè¦æŠŠå®ƒæ”¾åœ¨ pyproject.toml é‡Œï¼Ÿ

**é—®é¢˜ 3**ï¼šè¿åå•ä¸€èŒè´£
- mini_agent åº”è¯¥æ˜¯ä¸€ä¸ªçº¯ç²¹çš„ Agent åº“
- ä¸åº”è¯¥çŸ¥é“ä½¿ç”¨å®ƒçš„ Web æ¡†æ¶

---

## âœ… ç»“è®ºï¼šå½“å‰æ–¹å¼æ˜¯æ­£ç¡®çš„

### ä¸ºä»€ä¹ˆ sys.path æ–¹å¼åœ¨è¿™ä¸ªé¡¹ç›®ä¸­æ˜¯åˆç†çš„ï¼Ÿ

#### 1. èŒè´£åˆ†ç¦»

```
mini_agent/     â† å¯ç‹¬ç«‹å‘å¸ƒçš„ Agent åº“
    â†‘
    â”‚ å¼•ç”¨ï¼ˆä¸å®‰è£…ï¼‰
    â”‚
backend/        â† ç‹¬ç«‹çš„ Web åº”ç”¨
```

ç±»ä¼¼äºå¾ˆå¤šå¤§å‹é¡¹ç›®ï¼š
```
TensorFlow/
â”œâ”€â”€ tensorflow/     â† æ ¸å¿ƒåº“
â”œâ”€â”€ serving/        â† æœåŠ¡ç«¯ï¼ˆå¼•ç”¨ tensorflowï¼‰
â””â”€â”€ lite/           â† ç§»åŠ¨ç«¯ï¼ˆå¼•ç”¨ tensorflowï¼‰
```

#### 2. å…±äº«ç¯å¢ƒçº¯ç²¹

å…±äº«ç¯å¢ƒåªåŒ…å« Agent è¿è¡Œéœ€è¦çš„ä¾èµ–ï¼Œä¸åŒ…å« Web æ¡†æ¶ã€‚

#### 3. éƒ¨ç½²çµæ´»

- **CLI**ï¼š`pip install -e .`
- **åç«¯**ï¼š`pip install -r backend/requirements.txt` + sys.path
- **å…¶ä»–é›†æˆ**ï¼šå¯ä»¥è‡ªç”±é€‰æ‹©å¼•ç”¨æ–¹å¼

### è¿™ä¸æ˜¯"hack"ï¼Œè€Œæ˜¯"æ¾è€¦åˆ"è®¾è®¡

```
å¥½çš„æ¶æ„ï¼š
mini_agent (åº“) â†’ å¯ä»¥è¢«ä»»ä½•é¡¹ç›®ä½¿ç”¨
    â†‘
    â”‚ å¼•ç”¨
    â”‚
backend (åº”ç”¨) â†’ ä½¿ç”¨ mini_agentï¼Œä½†ä¸ä¿®æ”¹å®ƒ
```

åçš„æ¶æ„ï¼š
```
mini_agent (åº“ + åº”ç”¨) â†’ æ··åœ¨ä¸€èµ·
â”œâ”€â”€ æ ¸å¿ƒä»£ç 
â””â”€â”€ FastAPI ä»£ç   â† âŒ ä¸ºä»€ä¹ˆ Agent åº“è¦åŒ…å« Web æ¡†æ¶ï¼Ÿ
```

---

## ğŸ”§ å¦‚ä½•æ”¹å–„å¼€å‘ä½“éªŒ

### 1. é…ç½® IDE

**VSCode** (.vscode/settings.json):
```json
{
    "python.analysis.extraPaths": [
        "${workspaceFolder}"
    ]
}
```

**PyCharm**:
```
Settings â†’ Project â†’ Python Interpreter
â†’ Show All â†’ Show paths
â†’ Add â†’ é€‰æ‹© Mini-Agent æ ¹ç›®å½•
```

### 2. è‡ªåŠ¨åŒ–ä¾èµ–æ£€æŸ¥

åˆ›å»º `backend/check_deps.py`:
```python
"""æ£€æŸ¥ä¾èµ–æ˜¯å¦åŒæ­¥"""
import sys
from pathlib import Path

# è¯»å– pyproject.toml çš„ä¾èµ–
# è¯»å– backend/requirements.txt
# æ£€æŸ¥æ˜¯å¦åŒ…å«æ‰€æœ‰ mini_agent æ ¸å¿ƒä¾èµ–
```

### 3. æ–‡æ¡£è¯´æ˜

åœ¨ README ä¸­æ¸…æ¥šè¯´æ˜ï¼š
- mini_agent æ˜¯ç‹¬ç«‹çš„åº“
- backend æ˜¯ä½¿ç”¨ mini_agent çš„ Web æœåŠ¡
- ä¸¤è€…ä¾èµ–åˆ†å¼€ç®¡ç†æ˜¯æœ‰æ„ä¸ºä¹‹

---

## ğŸ“ æ€»ç»“

### ç”¨æˆ·çš„ç›´è§‰æ˜¯å¯¹çš„

**ä¸æ˜¯æ‰€æœ‰"æ ‡å‡†"åšæ³•éƒ½é€‚åˆæ‰€æœ‰åœºæ™¯ã€‚**

åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼š
- mini_agent = å¯ç‹¬ç«‹ä½¿ç”¨çš„ Agent åº“
- backend = ä½¿ç”¨ mini_agent çš„ Web åº”ç”¨
- å…±äº«ç¯å¢ƒ = åªåŒ…å« Agent æ ¸å¿ƒä¾èµ–

å› æ­¤ï¼Œ**å½“å‰çš„ sys.path æ–¹å¼æ˜¯åˆç†çš„æ¶æ„é€‰æ‹©**ã€‚

### æˆ‘ä¹‹å‰çš„å»ºè®®ä¸å¤Ÿå‘¨å…¨

æ¨è `pip install -e ".[backend]"` ä¼šå¯¼è‡´ï¼š
- âŒ mini_agent å’Œ backend èŒè´£æ··ä¹±
- âŒ å…±äº«ç¯å¢ƒå¯èƒ½åŒ…å«ä¸å¿…è¦çš„ä¾èµ–
- âŒ ç”¨æˆ·å›°æƒ‘ï¼šä¸ºä»€ä¹ˆ Agent åº“è¦å…³å¿ƒ FastAPIï¼Ÿ

### æ­£ç¡®çš„åšæ³•

âœ… **ä¿æŒå½“å‰æ–¹å¼**ï¼š
- mini_agent ç‹¬ç«‹ç»´æŠ¤ï¼ˆpyproject.tomlï¼‰
- backend ç‹¬ç«‹ç»´æŠ¤ï¼ˆrequirements.txtï¼‰
- é€šè¿‡ sys.path å¼•ç”¨æºç 

âœ… **æ”¹å–„å¼€å‘ä½“éªŒ**ï¼š
- é…ç½® IDE ä»¥æ”¯æŒè‡ªåŠ¨è¡¥å…¨
- æ·»åŠ è‡ªåŠ¨åŒ–æ£€æŸ¥ç¡®ä¿ä¾èµ–åŒæ­¥
- å®Œå–„æ–‡æ¡£è¯´æ˜æ¶æ„è®¾è®¡

---

æ„Ÿè°¢ç”¨æˆ·çš„æé†’ï¼ğŸ™

**æœ€åæ›´æ–°**: 2025-11-17
**ç»“è®º**: ä¿æŒå½“å‰ sys.path æ–¹å¼ âœ…
